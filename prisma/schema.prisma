generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Barbero {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String
  nombre       String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  bloqueos     Bloqueo[]
  citas        Cita[]
  horarios     Horario[]

  @@map("barbero")
}

model Servicio {
  id        String   @id @default(uuid())
  nombre    String
  precio    Decimal
  duracion  Int
  imagenUrl String?
  createdAt DateTime @default(now())
  citas     Cita[]

  @@map("servicio")
}

model Cita {
  id              String     @id @default(uuid())
  nombreCliente   String
  telefonoCliente String
  servicioId      String
  barberoId       String?
  fechaInicio     DateTime
  fechaFin        DateTime
  precio          Decimal
  estado          EstadoCita @default(PENDIENTE)
  stripePaymentId String?    // ID de pago de Stripe (si aplica)
  clienteId       String?    // ID del Cliente Registrado (Opcional, para V2.0)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  barbero         Barbero?   @relation(fields: [barberoId], references: [id])
  servicio        Servicio   @relation(fields: [servicioId], references: [id])
  cliente         Cliente?   @relation(fields: [clienteId], references: [id])

  @@index([fechaInicio, fechaFin])
  @@map("cita")
}

model Cliente {
  id        String   @id @default(uuid())
  nombre    String
  email     String   @unique
  password  String   // Hash borroso
  telefono  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  citas     Cita[]

  @@map("cliente")
}

model Horario {
  id         String   @id @default(uuid())
  barberoId  String
  diaSemana  Int
  horaInicio String
  horaFin    String
  activo     Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  barbero    Barbero  @relation(fields: [barberoId], references: [id])

  @@unique([barberoId, diaSemana])
  @@map("horario")
}

model Bloqueo {
  id          String   @id @default(uuid())
  barberoId   String
  fechaInicio DateTime
  fechaFin    DateTime
  motivo      String?
  createdAt   DateTime @default(now())
  barbero     Barbero  @relation(fields: [barberoId], references: [id])

  @@map("bloqueo")
}

enum EstadoCita {
  PENDIENTE
  CONFIRMADA
  CANCELADA
  COMPLETADA
}
